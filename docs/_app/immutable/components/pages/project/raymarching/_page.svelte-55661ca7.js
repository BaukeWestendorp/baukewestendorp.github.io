var b=Object.defineProperty;var v=(n,t,e)=>t in n?b(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var l=(n,t,e)=>(v(n,typeof t!="symbol"?t+"":t,e),e);import{S as D,i as z,s as C,k as u,q as S,a as j,l as p,m,r as O,h as o,c as R,n as W,b as f,C as x,B as g,o as q,M as y}from"../../../../chunks/index-514c8609.js";class A{constructor(t,e){l(this,"depth",0);l(this,"iteration",0);l(this,"closestWorldObject");this.x=t,this.y=e}march(t,e,a){let s=a;for(const r of t){const i=r.sdf({x:this.x,y:this.y,z:this.depth});i<s&&(s=i,this.closestWorldObject=r)}if(this.depth+=s,!(s<=e)){if(this.depth>a||this.iteration>100){this.depth=-1;return}this.iteration++,this.march(t,e,a)}}}class E{constructor(t,e){this.position=t,this.color=e,this.position=t,this.color=e}}class _ extends E{constructor(t,e,a){super(t,e),this.radius=a,this.radius=a}sdf(t){const e=t.x-this.position.x,a=t.y-this.position.y,s=t.z-this.position.z,r=e*e+a*a+s*s;return Math.sqrt(r)-this.radius}}class F{constructor(t){this.renderer=t,this.renderer=t}calculateFrame(){var e,a,s;const t=[new _({x:200,y:170,z:150},[255,127,0],100),new _({x:500,y:320,z:250},[0,255,127],80)];for(let r=0;r<this.renderer.ctx.canvas.height;r++)for(let i=0;i<this.renderer.ctx.canvas.width;i++){const c=new A(i,r);if(c.march(t,1,1e3),c.depth>0){const h=(a=(e=c.closestWorldObject)==null?void 0:e.color)!=null?a:[255,255,255],d=c.depth/(((s=c.closestWorldObject)==null?void 0:s.radius)*2),w=[h[0]*d,h[1]*d,h[2]*d];this.renderer.setPixel(i,r,w)}else this.renderer.setPixel(i,r,[c.iteration*3,c.iteration*3,c.iteration*3])}}}class I{constructor(t){l(this,"imageData");this.ctx=t,this.ctx.imageSmoothingEnabled=!1,this.imageData=this.ctx.getImageData(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}render(){this.ctx.putImageData(this.imageData,0,0)}setPixel(t,e,a){const s=(e*this.imageData.width+t)*4;this.imageData.data[s]=a[0],this.imageData.data[s+1]=a[1],this.imageData.data[s+2]=a[2],this.imageData.data[s+3]=255}}function M(n){let t,e,a,s,r;return{c(){t=u("h2"),e=S("Ray-marching"),a=j(),s=u("div"),r=u("canvas"),this.h()},l(i){t=p(i,"H2",{});var c=m(t);e=O(c,"Ray-marching"),c.forEach(o),a=R(i),s=p(i,"DIV",{class:!0});var h=m(s);r=p(h,"CANVAS",{}),m(r).forEach(o),h.forEach(o),this.h()},h(){W(s,"class","wrapper svelte-dr9iz4")},m(i,c){f(i,t,c),x(t,e),f(i,a,c),f(i,s,c),x(s,r),n[2](r),n[3](s)},p:g,i:g,o:g,d(i){i&&o(t),i&&o(a),i&&o(s),n[2](null),n[3](null)}}}function k(n,t,e){let a,s,r;q(()=>{a.setAttribute("width",window.getComputedStyle(s).width),a.setAttribute("height",window.getComputedStyle(s).height);const h=a.getContext("2d");h&&(r=new I(h),new F(r).calculateFrame(),r.render())});function i(h){y[h?"unshift":"push"](()=>{a=h,e(0,a)})}function c(h){y[h?"unshift":"push"](()=>{s=h,e(1,s)})}return[a,s,i,c]}class B extends D{constructor(t){super(),z(this,t,k,M,C,{})}}export{B as default};

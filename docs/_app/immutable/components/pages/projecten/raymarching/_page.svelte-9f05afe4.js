var z=Object.defineProperty;var C=(n,t,e)=>t in n?z(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var d=(n,t,e)=>(C(n,typeof t!="symbol"?t+"":t,e),e);import{S,i as j,s as E,a as x,k as m,q as O,E as R,h as o,c as _,l as f,m as y,r as W,n as q,b as p,C as w,B as g,o as A,M as b}from"../../../../chunks/index-514c8609.js";class k{constructor(t,e){d(this,"depth",0);d(this,"iteration",0);d(this,"closestWorldObject");this.x=t,this.y=e}march(t,e,s){let a=s;for(const r of t){const h=r.sdf({x:this.x,y:this.y,z:this.depth});h<a&&(a=h,this.closestWorldObject=r)}if(this.depth+=a,!(a<=e)){if(this.depth>s||this.iteration>100){this.depth=-1;return}this.iteration++,this.march(t,e,s)}}}class D{constructor(t,e){this.position=t,this.color=e,this.position=t,this.color=e}}class v extends D{constructor(t,e,s){super(t,e),this.radius=s,this.radius=s}sdf(t){const e=t.x-this.position.x,s=t.y-this.position.y,a=t.z-this.position.z,r=e*e+s*s+a*a;return Math.sqrt(r)-this.radius}}class F extends D{sdf(t){return t.y-this.position.y}}class I{constructor(t){this.renderer=t,this.renderer=t}calculateFrame(){var e,s,a;const t=[new v({x:200,y:170,z:150},[255,127,0],100),new v({x:500,y:320,z:250},[0,255,127],80),new F({x:0,y:-100,z:0},[127,200,127])];for(let r=0;r<this.renderer.ctx.canvas.height;r++)for(let h=0;h<this.renderer.ctx.canvas.width;h++){const i=new k(h,r);if(i.march(t,1,1e3),i.depth>0){const c=(s=(e=i.closestWorldObject)==null?void 0:e.color)!=null?s:[255,255,255],l=i.depth/(((a=i.closestWorldObject)==null?void 0:a.radius)*2),u=[c[0]*l,c[1]*l,c[2]*l];this.renderer.setPixel(h,r,u)}else this.renderer.setPixel(h,r,[i.iteration*3,i.iteration*3,i.iteration*3])}}}class M{constructor(t){d(this,"imageData");this.ctx=t,this.ctx.imageSmoothingEnabled=!1,this.imageData=this.ctx.getImageData(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}render(){this.ctx.putImageData(this.imageData,0,0)}setPixel(t,e,s){const a=(e*this.imageData.width+t)*4;this.imageData.data[a]=s[0],this.imageData.data[a+1]=s[1],this.imageData.data[a+2]=s[2],this.imageData.data[a+3]=255}}function P(n){let t,e,s,a,r,h;return{c(){t=x(),e=m("h2"),s=O("Ray-marching"),a=x(),r=m("div"),h=m("canvas"),this.h()},l(i){R("svelte-1ncbyp7",document.head).forEach(o),t=_(i),e=f(i,"H2",{});var l=y(e);s=W(l,"Ray-marching"),l.forEach(o),a=_(i),r=f(i,"DIV",{class:!0});var u=y(r);h=f(u,"CANVAS",{}),y(h).forEach(o),u.forEach(o),this.h()},h(){document.title="Bauke Westendorp: Ray-marching",q(r,"class","wrapper svelte-dr9iz4")},m(i,c){p(i,t,c),p(i,e,c),w(e,s),p(i,a,c),p(i,r,c),w(r,h),n[2](h),n[3](r)},p:g,i:g,o:g,d(i){i&&o(t),i&&o(e),i&&o(a),i&&o(r),n[2](null),n[3](null)}}}function B(n,t,e){let s,a,r;A(()=>{s.setAttribute("width",window.getComputedStyle(a).width),s.setAttribute("height",window.getComputedStyle(a).height);const c=s.getContext("2d");c&&(r=new M(c),new I(r).calculateFrame(),r.render())});function h(c){b[c?"unshift":"push"](()=>{s=c,e(0,s)})}function i(c){b[c?"unshift":"push"](()=>{a=c,e(1,a)})}return[s,a,h,i]}class N extends S{constructor(t){super(),j(this,t,B,P,E,{})}}export{N as default};
